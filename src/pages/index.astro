---
import Layout from '../layouts/Page.astro';
import Container from '../components/containers/Container.astro';
import BlogPostsList from '../components/post/BlogPostsList.astro';
import { getPosts } from '../libs/post';
import Reveal from '../components/Reveal.astro';
import ScrollDown from '../components/ui/ScrollDown.astro';
import SceneController from '../components/ui/SceneController/SceneController.astro';

const seo = {
	title: 'cloud-np',
	description: 'A simple blog focused on provided the best',
};

const allPosts = await getPosts(undefined);
const posts = allPosts.filter((post) => !post.personal);
---

<Layout seo={seo}>
	<!-- <Reveal /> -->
	<SceneController />
	<Container>
		<section class="landing mt-28">
			<div class="moon"></div>
			<div class="moon moonRight"></div>
			<div class="hero-text-container m-auto mb-16">
				<div class="justify-center flex mb-10 overflow-hidden">
					<h1 class="hero-title-text">Hi</h1>
					<h1 class="hero-title-text">there!</h1>
					<h1 class="hero-title-text">I'm</h1>
					<h1 class="hero-title-text slow-fade">Nick.</h1>
				</div>
				<div class="overflow-hidden">
					<p class="flex justify-center hero-text slow-fade">
						Elegance in code, boldness in design. Transforming
						visions into reality with some frontend wizardry.
					</p>
				</div>
			</div>
			<div class="m-auto scroll-down-indicator">
				<ScrollDown />
			</div>
		</section>
		<section class="about bg-white w-max h-max">
			<h2 class="hero-title-text">Portofolio</h2>
		</section>
		<section>
			<h4 class="projects-title fade-in">Latest Posts</h4>
			<BlogPostsList class="latest-projects-container" posts={posts} />
		</section>
	</Container>
</Layout>

<script>
	import gsap from 'gsap';
	import { ScrollTrigger } from 'gsap/all';
	import { ScrollableElement, Scroll } from '../components/ui/ScrollController/ScrollController';

	gsap.registerPlugin(ScrollTrigger);

	function init(delay: number = 0) {
		const tl = gsap.timeline({
			defaults: { ease: 'power2.out' },
			// scrollBehavior: "smooth",
		});
		tl.to('.hero-title-text', { duration: 0.8, y: 0, delay: delay })
			.to('.hero-text', { duration: 0.8, y: 0 }, '-=0.4')
			.to('.scroll-down-indicator', { duration: 1.2, opacity: 1 });
		// tl.to('.hero-text-container', {
		// 	scrollTrigger: {
		// 		trigger: '.hero-text-container',
		// 		// start: 'top top',
		// 		start: 'top 20%',
		// 		end: 'bottom center',
		// 		scrub: true,
		// 		markers: true,
		// 	},
		// 	y: 70,
		// 	scale: 0.5,
		// 	duration: 2.2,
		// });
		// window.addEventListener('scroll', updateOpacityOnScroll);
	}

	// Scroll.el('.hero-text-container',
	// 	{
	// 		y: () => window.scrollY,
	// 		scale: () => 1 - window.scrollY / 3200
	// 	},
	// 	{
	// 		startCondition: (y) => y > 100,
	// 		endCondition: (y) => y > 1000,
	// 	}
	// );

	// Scroll.el('.scroll-down-indicator', {
    //     opacity: () => window.scrollY - 100 >= 0 ? Math.max(1 - (window.scrollY - 100) / 20, 0) : 1
	// });

	Scroll.el('.about', {
        y: (y) => y - 5,
    });

	// init(3.72);
	init();
	document.addEventListener('astro:after-swap', () => init());
</script>

<style>
	/* Mirror effect */
	/* .home-hero__welcome-text-cont::after {
		content: "Hi there! I'm Nick.";
		margin-top: max(-26px, -4vw);
		display: flex;
		text-align: center;
		justify-content: center;
		transform: rotateX(180deg);
		background-image: linear-gradient(
			180deg,
			rgba(255, 255, 255, 0) 25%,
			rgba(255, 255, 255, 0.1)
		);
		-webkit-background-clip: text;
		color: transparent;
		white-space: nowrap;
	} */

	.landing {
		padding: 5vh 0;
		display: flex;
		flex-direction: column;
		color: var(--primary);
	}
	/* all .5s cubic-bezier(.76,0,.24,1); */

	.about {
		margin-top: 50vh;
	}

	.moon {
		width: min(400px, 30vw);
		height: min(400px, 30vw);
		position: absolute;
		top: 10vh;
		left: 5vw;
		border-radius: 50%;
		z-index: -5;
		background: linear-gradient(
			-90deg,
			rgb(26, 26, 26) 10%,
			rgb(15, 15, 15)
		);
		cursor: none;
	}

	.moonRight {
		top: 20vh;
		left: 80vw;
		background: linear-gradient(
			90deg,
			rgb(26, 26, 26) 10%,
			rgb(15, 15, 15)
		);
	}

	.hero-title-text {
		transform: translateY(100%);
		margin-right: 13px;
		z-index: -1;
	}

	.no-overflowing {
		overflow: hidden;
		border: 1px solid green;
	}

	h1 {
		text-align: center;
		max-width: 100%;
		font-size: min(6rem, 9vw);
		white-space: nowrap;
	}

	.hero-text {
		font-size: 1.3rem;
		transform: translateY(100%);
		max-width: min(var(--md-container), 600px);
		margin: auto;
		text-align: center;
	}

	.slow-fade {
		position: relative;
		mask-image: linear-gradient(115deg, #fff 34%, hsla(0, 0%, 100%, 0) 95%);
		-webkit-mask-image: linear-gradient(
			115deg,
			#fff 34%,
			hsla(0, 0%, 100%, 0) 95%
		);
	}

	.hero-text-container {
		/* transition: all 0.7s cubic-bezier(0.76, 0, 0.24, 1); */
		transition: all 0.3s ease-out;
	}

	.scroll-down-indicator {
		position: absolute;
		top: 85%;
		left: 50%;
		opacity: 0;
		transition: all 0.5s cubic-bezier(0.76, 0, 0.24, 1);
	}

	.latest-projects-container {
		padding-top: 2rem;
	}

	.projects-title {
		margin-top: 6rem;
		margin-bottom: 3rem;
	}
</style>

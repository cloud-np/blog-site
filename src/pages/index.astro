---
import Layout from "../layouts/Page.astro";
import BlogPostsList from "../components/post/BlogPostsList.astro";
import { getPosts } from "../libs/post";
import Reveal from "../components/Reveal.astro";
import ScrollDown from "../components/ui/ScrollDown.astro";
import SceneController from "../components/ui/SceneController/SceneController.astro";

const seo = {
	title: "cloud-np",
	description: "A simple blog focused on provided the best",
};

const allPosts = await getPosts(undefined);
const posts = allPosts.filter((post) => !post.personal);
---

<Layout seo={seo}>
	<!-- <Reveal /> -->
	<SceneController />
	<div class="container">
		<section class="landing px-3">
			<div class="moon"></div>
			<div class="moon moonRight"></div>
			<!-- TODO: Tailwind not working -->
			<div class="hero-text-container mb-16">
				<div class="hero-title-text-container justify-center flex mb-10 overflow-hidden">
					<h1 class="hero-title-text">Hi</h1>
					<h1 class="hero-title-text">there!</h1>
					<h1 class="hero-title-text">I'm</h1>
					<h1 class="hero-title-text slow-fade">Nick</h1>
				</div>
				<div class="overflow-hidden">
					<p class="flex justify-center hero-text slow-fade">
						With elegance in code and boldness in design. I enjoy transforming
						visions into reality with some frontend wizardry.
					</p>
				</div>
			</div>
			<div class="m-auto scroll-down-indicator">
				<ScrollDown />
			</div>
		</section>
		<section class="about bg-zinc-900 w-max h-max flex justify-center">
			<h2 class="about-title text-sky-400 p-16">Portofolio</h2>
			<div></div>
		</section>
		<section>
			<h4 class="projects-title fade-in">Latest Posts</h4>
			<BlogPostsList class="latest-projects-container" posts={posts} />
		</section>
	</div>
</Layout>

<script>
	import gsap from "gsap";
	import { ScrollTrigger } from "gsap/all";
	import { Scroll } from "../components/ui/ScrollController/ScrollController";

	const REVEAL_DELAY = 3.72;
	gsap.registerPlugin(ScrollTrigger);

	function init(delay: number = 0) {
		const tl = gsap.timeline({
			defaults: { ease: "power2.out" },
			scrollBehavior: "smooth",
		});
		tl.to(".hero-title-text", { duration: 0.8, y: 0, delay: delay }).to(
			".hero-text",
			{ duration: 0.8, y: 0 },
			"-=0.4",
		);
		tl.to(".about", {
			scrollTrigger: {
				trigger: ".about",
				start: "top-=500 center",
				end: "bottom-=300 center",
				scrub: true,
				markers: true,
			},
			y: -300,
			width: "85%",
			duration: 2.2,
		});
		// window.addEventListener('scroll', updateOpacityOnScroll);
	}

	// Scroll.el(".about", {
	// 	y: (y, direction) => y + -1 * direction * 5,
	// });

	Scroll.el(".scroll-down-indicator", {
		opacity: () =>
			window.scrollY - 100 >= 0
				? Math.max(1 - (window.scrollY - 100) / 20, 0)
				: 1,
	});

	// init(REVEAL_DELAY);
	init();
	document.addEventListener("astro:after-swap", () => init());
</script>

<style>
	/* Mirror effect */
	/* .home-hero__welcome-text-cont::after {
		content: "Hi there! I'm Nick.";
		margin-top: max(-26px, -4vw);
		display: flex;
		text-align: center;
		justify-content: center;
		transform: rotateX(180deg);
		background-image: linear-gradient(
			180deg,
			rgba(255, 255, 255, 0) 25%,
			rgba(255, 255, 255, 0.1)
		);
		-webkit-background-clip: text;
		color: transparent;
		white-space: nowrap;
	} */

	.landing {
		padding: 5vh 0;
		display: flex;
		flex-direction: column;
		overflow-x: hidden;
		height: 85vh;
		color: var(--primary);
	}
	/* all .5s cubic-bezier(.76,0,.24,1); */

	.about {
		margin-top: 5vh;
		height: 500px;
		border-radius: 5px;
		transition: all 0.3s ease-out;
	}

	.about-title {
		text-align: center;
		transition: all 0.3s ease-out;
	}

	.moon {
		width: min(400px, 30vw);
		height: min(400px, 30vw);
		position: absolute;
		top: 10vh;
		left: 5vw;
		border-radius: 50%;
		z-index: -5;
		background: linear-gradient(
			-90deg,
			rgb(26, 26, 26) 10%,
			rgb(15, 15, 15)
		);
		cursor: none;
	}

	.moonRight {
		top: 20vh;
		left: 80vw;
		overflow-x: hidden;
		background: linear-gradient(
			90deg,
			rgb(26, 26, 26) 10%,
			rgb(15, 15, 15)
		);
	}

	@media (max-width: 768px) {
		.moonRight {
			display: none;
		}
	}

	.hero-title-text-container .hero-title-text:not(:last-child) {
		margin-right: 13px;
	}

	.hero-title-text {
		transform: translateY(100%);
		z-index: -1;
	}

	.no-overflowing {
		overflow: hidden;
		border: 1px solid green;
	}

	h1 {
		text-align: center;
		max-width: 100%;
		font-size: min(6rem, 9vw);
		white-space: nowrap;
	}

	.hero-text {
		font-size: 1.3rem;
		transform: translateY(100%);
		max-width: min(var(--md-container), 600px);
		margin: auto;
		text-align: center;
	}

	.slow-fade {
		position: relative;
		mask-image: linear-gradient(115deg, #fff 34%, hsla(0, 0%, 100%, 0) 95%);
		-webkit-mask-image: linear-gradient(
			115deg,
			#fff 34%,
			hsla(0, 0%, 100%, 0) 95%
		);
	}

	.hero-text-container {
		/* transition: all 0.7s cubic-bezier(0.76, 0, 0.24, 1); */
		transition: all 0.3s ease-out;
	}

	.scroll-down-indicator {
		position: absolute;
		top: 85%;
		left: 50%;
		opacity: 0;
		transition: all 0.5s cubic-bezier(0.76, 0, 0.24, 1);
	}

	.latest-projects-container {
		padding-top: 2rem;
	}

	.projects-title {
		margin-top: 6rem;
		margin-bottom: 3rem;
	}

	.container {
		width: 100%;
		margin: 0 auto;
		max-width: var(--lg-container, 960px);
		/* padding: var(--container-padding, 1rem); */
	}

	@media (max-width: 768px) {
		.container {
			display: flex;
			flex-direction: column;
		}
	}
</style>
